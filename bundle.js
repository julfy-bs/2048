(()=>{"use strict";var t,o="#bbada0",i="Clear Sans, 'Helvetica Neue', 'Arial', sans-serif",e=window.innerWidth<552?window.innerWidth-20:572,n=window.innerHeight<749.32?window.innerHeight-100:749.32,a=12,r=1.01*e,s=n-r,c=window.innerWidth<552?e/4-15:128,l=e/2-6,h=window.innerWidth<552?20:40,f={board:{size:e,color:o,strokeColor:"#000",padding:a,font:i,fontSize:h,fontColor:"#776e65",map:[[{x:a,y:s+a,value:null,coordinates:[0,0]},{x:24+c,y:s+a,value:null,coordinates:[1,0]},{x:36+2*c,y:s+a,value:null,coordinates:[2,0]},{x:48+3*c,y:s+a,value:null,coordinates:[3,0]}],[{x:a,y:s+24+c,value:null,coordinates:[0,1]},{x:24+c,y:s+24+c,value:null,coordinates:[1,1]},{x:36+2*c,y:s+24+c,value:null,coordinates:[2,1]},{x:48+3*c,y:s+24+c,value:null,coordinates:[3,1]}],[{x:a,y:s+36+2*c,value:null,coordinates:[0,2]},{x:24+c,y:s+36+2*c,value:null,coordinates:[1,2]},{x:36+2*c,y:s+36+2*c,value:null,coordinates:[2,2]},{x:48+3*c,y:s+36+2*c,value:null,coordinates:[3,2]}],[{x:a,y:s+48+3*c,value:null,coordinates:[0,3]},{x:24+c,y:s+48+3*c,value:null,coordinates:[1,3]},{x:36+2*c,y:s+48+3*c,value:null,coordinates:[2,3]},{x:48+3*c,y:s+48+3*c,value:null,coordinates:[3,3]}]]},cell:{size:c},game:{size:4},canvas:{width:e,headerHeight:s,contentHeight:r},score:{score:{position:[e/2+6,0]},bestScore:{position:(window.innerWidth,[0,0])},height:55,width:l,color:o,font:i,fontColor:"#eee4da",fontSize:30},button:{height:55,width:e,color:"#8f7a66",position:window.innerWidth<552?[0,55+h+24]:[0,55+h+a],title:"Restart"}},u={2:"#eee4da",4:"#ece0c7",8:"#f2b176",16:"#f59564",32:"#f67b5e",64:"#f55a37",128:"#edd072",256:"#edcc62",512:"#efc752",1024:"#ecc43e",2048:"#e9bf2c",4096:"#ff3d40",8192:"#ff1e20",16384:"#ff1e1d",32768:"#ff1e20"};!function(t){t.OVER="over",t.CONTINUES="continues",t.NEW="new",t.WIN="win"}(t||(t={}));var d,_=function(t){for(var o=0;o<t.length;o++)for(var i=0;i<t.length;i++)if(t[o][i].value>=2048)return!0;return!1},g=function(t,o){return Math.floor(Math.random()*(o-t)+t)},p=function(){function o(t){var o,i,e,n=t.canvas,a=t.ctx,r=t.config,s=t.engine;this._ctx=a,this._config=r,this._moveCounter=0,this._nativeStopper=!1,this._config=r,this._score=null!==(o=JSON.parse(localStorage.getItem("score")))&&void 0!==o?o:0,this._bestScore=null!==(i=JSON.parse(localStorage.getItem("bestScore")))&&void 0!==i?i:0,this._engine=s,this._oldX=0,this._oldY=0,this._cache=null!==(e=JSON.parse(localStorage.getItem("cache")))&&void 0!==e?e:null,this._canvas=n}return o.prototype._create=function(){var o=this,i=this._engine,e=i.cell,n=i.tile,a=i.board,r=i.score,s=i.button;return{board:function(){return a({ctx:o._ctx,config:o._config})},cell:function(){return function(t){for(var o=t.ctx,i=t.config,e=t.cell,n=[],a=0;a<i.board.map.length;a++)for(var r=0;r<i.board.map.length;r++){var s=e({ctx:o,size:i.cell.size,config:i,coordinates:i.board.map[a][r].coordinates});n.push(s)}return n}({ctx:o._ctx,config:o._config,cell:e})},tile:function(){for(var i,e,a=!1;!a&&o._isCreatingTilesAvailable;){e=n({ctx:o._ctx,coordinates:[g(0,o._config.game.size),g(0,o._config.game.size)],value:g(0,100)>90?4:2,config:o._config});var r=null===o._config.board.map[e.coordinates[0]][e.coordinates[1]].value;r&&!(null===(i=o._config.board.map[e.coordinates[0]][e.coordinates[1]])||void 0===i?void 0:i.value)?(o._config.board.map[e.coordinates[0]][e.coordinates[1]].value=e.value,a=!0,_(o._config.board.map)&&(o._gameStatus=t.WIN),o._checkLose(),o._findFreeCells()):r||o._isCreatingTilesAvailable||(o._checkLose(),o._endGame())}return e},score:function(){return r({ctx:o._ctx,config:o._config,position:o._config.score.score.position,value:o._score,title:"Score"})},bestScore:function(){return r({ctx:o._ctx,config:o._config,position:o._config.score.bestScore.position,value:o._bestScore,title:"Best score"})},button:function(){var t=s({ctx:o._ctx,config:o._config,position:o._config.button.position,title:o._config.button.title});return o._restartButton=t,t}}},o.prototype._update=function(){localStorage.setItem("cache",JSON.stringify(this._config.board.map)),localStorage.setItem("score",JSON.stringify(this._score)),localStorage.setItem("bestScore",JSON.stringify(this._bestScore)),this._cleanGame(),this._checkScore(),_(this._config.board.map)&&(this._gameStatus=t.WIN),this._findFreeCells(),this._checkLose(),this._draw().all(),this._gameStatus!==t.OVER?(this._gameStatus===t.WIN&&this._winGame(),this._nativeStopper=!1,this._gameStatus=t.CONTINUES):this._endGame()},o.prototype._restartGame=function(){if(this._gameStatus===t.NEW){for(var o=0;o<this._config.board.map.length;o++)for(var i=0;i<this._config.board.map.length;i++)this._config.board.map[o][i].value=null;this._cleanGame(),this._startFirstRound()}},o.prototype._cleanGame=function(){this._ctx.clearRect(0,0,this._config.board.size,this._config.board.size)},o.prototype._startFirstRound=function(){this._gameCached&&this._gameStatus===t.CONTINUES&&(this._downloadGameData(),this._checkLose(),this._findFreeCells(),_(this._config.board.map)&&(this._gameStatus=t.WIN),this._checkLose()),this._gameStatus===t.NEW&&(this._findFreeCells(),this._score=0,this._create().tile(),this._create().tile()),this._draw().all(),this._gameStatus===t.OVER&&this._endGame(),this._gameStatus===t.WIN&&this._winGame()},o.prototype._checkLose=function(){(function(t){for(var o=t.matrix,i=t.isCreatingTilesAvailable,e=0;e<o.length;e++)for(var n=0;n<o.length;n++){if(null===o[e][n].value)return!1;if(0!==e&&o[e][n].value===o[e-1][n].value)return!1;if(3!==e&&o[e][n].value===o[e+1][n].value)return!1;if(0!==n&&o[e][n].value===o[e][n-1].value)return!1;if(3!==n&&o[e][n].value===o[e][n+1].value)return!1;if(i)return!1}return!0})({matrix:this._config.board.map,isCreatingTilesAvailable:this._isCreatingTilesAvailable})&&(this._gameStatus=t.OVER)},o.prototype._downloadGameData=function(){this._checkScore();for(var t=0;t<this._config.board.map.length;t++)for(var o=0;o<this._config.board.map.length;o++)this._config.board.map[t][o].value=this._cache[t][o].value;this._draw().tiles()},o.prototype._findFreeCells=function(){var t=function(t){for(var o=[],i=0;i<t.length;i++)for(var e=0;e<t.length;e++)null===t[i][e].value&&o.push([i,e]);return{freeCells:o,isCreatingTilesAvailable:o.length>0}}(this._config.board.map).isCreatingTilesAvailable;this._isCreatingTilesAvailable=t},o.prototype._draw=function(){var t=this,o=this._create(),i=o.board,e=o.cell,n=o.score,a=o.bestScore,r=o.button,s=this._engine.tile;return{board:function(){i().draw()},cell:function(){e().forEach((function(t){return t.draw()}))},tiles:function(){for(var o=0;o<t._config.board.map.length;o++)for(var i=0;i<t._config.board.map.length;i++)null!==t._config.board.map[o][i].value&&s({ctx:t._ctx,config:t._config,coordinates:t._config.board.map[o][i].coordinates,value:t._config.board.map[o][i].value}).draw()},score:function(){n().draw()},bestScore:function(){a().draw()},button:function(){r().draw()},all:function(){t._draw().score(),t._draw().bestScore(),t._draw().button(),t._draw().board(),t._draw().cell(),t._draw().tiles()}}},o.prototype._checkScore=function(){this._score>this._bestScore&&(this._bestScore=this._score)},o.prototype._endGame=function(){if(this._gameStatus===t.OVER){var o=(0,this._engine.board)({ctx:this._ctx,config:this._config});o.alert("Game over =("),o.draw()}},o.prototype._winGame=function(){if(this._gameStatus===t.WIN){var o=(0,this._engine.board)({ctx:this._ctx,config:this._config});o.alert("Well played, you win!"),o.draw()}},o}(),v=(d=function(t,o){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])},d(t,o)},function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=t}d(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}),b=function(o){function i(i){var e=i.canvas,n=i.ctx,a=i.config,r=i.engine,s=o.call(this,{canvas:e,ctx:n,config:a,engine:r})||this;return s._handleKeyboardEvents=function(o){if(s._gameStatus!==t.OVER){var i=s._controller(),e=i.up,n=i.down,a=i.left,r=i.right;"ArrowUp"===o.key&&(s._nativeStopper||e(),s._update()),"ArrowRight"===o.key&&(s._nativeStopper||r(),s._update()),"ArrowDown"===o.key&&(s._nativeStopper||n(),s._update()),"ArrowLeft"===o.key&&(s._nativeStopper||a(),s._update())}},s}return v(i,o),i.prototype.addEventListeners=function(){var o=this;window.addEventListener("keydown",(function(t){return o._handleKeyboardEvents(t)})),this._canvas.addEventListener("click",(function(i){var e=o._canvas.getBoundingClientRect(),n=i.clientX-e.left,a=i.clientY-e.top;o._restartButton.clickButton(n,a)&&(o._gameStatus=t.NEW,o._restartGame())})),window.addEventListener("mousedown",(function(t){return o._handleMouseDownEvent(t)})),window.addEventListener("mouseup",(function(t){return o._handleMouseUpEvent(t)})),window.addEventListener("touchstart",(function(t){return o._handleTouchStartEvent(t)})),window.addEventListener("touchend",(function(t){return o._handleTouchEndEvent(t)}))},i.prototype._handleMouseDownEvent=function(o){this._gameStatus!==t.OVER&&(this._oldY=o.pageY,this._oldX=o.pageX)},i.prototype._handleDirection=function(o,i){if(this._gameStatus!==t.OVER){var e=this._controller(),n=e.up,a=e.down,r=e.left,s=e.right;if(Math.abs(o)>Math.abs(i))o>0?(this._nativeStopper||r(),this._update()):o<0&&(this._nativeStopper||s(),this._update());else{if(!(Math.abs(o)<Math.abs(i)))return;i>0?(this._nativeStopper||n(),this._update()):i<0&&(this._nativeStopper||a(),this._update())}}},i.prototype._handleMouseUpEvent=function(o){if(this._gameStatus!==t.OVER){var i=this._oldX-o.pageX,e=this._oldY-o.pageY;this._handleDirection(i,e)}},i.prototype._handleTouchStartEvent=function(o){this._gameStatus!==t.OVER&&(this._oldX=Math.floor(o.changedTouches[0].pageX),this._oldY=Math.floor(o.changedTouches[0].pageY))},i.prototype._handleTouchEndEvent=function(o){if(this._gameStatus!==t.OVER){var i=this._oldX-Math.floor(o.changedTouches[0].pageX),e=this._oldY-Math.floor(o.changedTouches[0].pageY);this._handleDirection(i,e)}},i.prototype._controller=function(){var t=this,o=!1;return{up:function(){for(var i,e=0;e<t._config.game.size;e++)for(var n=1;n<t._config.game.size;n++)if(null===(i=t._config.board.map[n][e])||void 0===i?void 0:i.value)for(var a=n;a>0;){if(t._config.board.map[a-1][e].value){if(t._config.board.map[a-1][e].value===t._config.board.map[a][e].value){t._config.board.map[a-1][e].value*=2,t._score+=t._config.board.map[a-1][e].value,t._config.board.map[a][e].value=null,o=!0;break}break}t._config.board.map[a-1][e].value=t._config.board.map[a][e].value,t._config.board.map[a][e].value=null,o=!0,a--}o&&(t._moveCounter++,t._nativeStopper=!0,t._create().tile())},right:function(){for(var i,e,n=0;n<t._config.game.size;n++)for(var a=t._config.game.size-2;a>=0;a--){var r=a;if(null===(i=t._config.board.map[n][a])||void 0===i?void 0:i.value)for(;r+1<t._config.game.size;){if(null===(e=t._config.board.map[n][r+1])||void 0===e?void 0:e.value){if(t._config.board.map[n][r+1].value===t._config.board.map[n][r].value){t._config.board.map[n][r+1].value*=2,t._score+=t._config.board.map[n][r+1].value,t._config.board.map[n][r].value=null,o=!0;break}break}t._config.board.map[n][r+1].value=t._config.board.map[n][r].value,t._config.board.map[n][r].value=null,o=!0,r++}}o&&(t._moveCounter++,t._nativeStopper=!0,t._create().tile())},down:function(){for(var i=0;i<t._config.game.size;i++)for(var e=t._config.game.size-2;e>=0;e--){var n=e;if(t._config.board.map[e][i].value)for(;n+1<t._config.game.size;){if(t._config.board.map[n+1][i].value){if(t._config.board.map[n+1][i].value===t._config.board.map[n][i].value){t._config.board.map[n+1][i].value*=2,t._score+=t._config.board.map[n+1][i].value,t._config.board.map[n][i].value=null,o=!0;break}break}t._config.board.map[n+1][i].value=t._config.board.map[n][i].value,t._config.board.map[n][i].value=null,o=!0,n++}}o&&(t._moveCounter++,t._nativeStopper=!0,t._create().tile())},left:function(){for(var i=0;i<t._config.game.size;i++)for(var e=1;e<t._config.game.size;e++){var n=e;if(t._config.board.map[i][e].value)for(;n>0;){if(t._config.board.map[i][n-1].value){if(t._config.board.map[i][n-1].value===t._config.board.map[i][n].value){t._config.board.map[i][n-1].value*=2,t._score+=t._config.board.map[i][n-1].value,t._config.board.map[i][n].value=null,o=!0;break}break}t._config.board.map[i][n-1].value=t._config.board.map[i][n].value,t._config.board.map[i][n].value=null,o=!0,n--}}o&&(t._moveCounter++,t._nativeStopper=!0,t._create().tile())}}},i}(p),x=function(){var t=function(o,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])},t(o,i)};return function(o,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function e(){this.constructor=o}t(o,i),o.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}}(),m=function(o){function i(t){var i=t.canvas,e=t.ctx,n=t.config,a=t.engine;return o.call(this,{canvas:i,ctx:e,config:n,engine:a})||this}return x(i,o),i.prototype.start=function(){null!==this._cache&&0!==this._score?(this._gameCached=!0,this._gameStatus=t.CONTINUES):this._gameStatus=t.NEW,this._startFirstRound(),this.addEventListeners()},i}(b),y=function(){function t(t){var o=t.ctx,i=t.config;this.ctx=o,this.color=i.board.color,this.size=i.board.size,this.config=i}return t.prototype.draw=function(){this.ctx.fillStyle=this.color,this.ctx.beginPath(),this.ctx.roundRect(0,this.config.canvas.headerHeight,this.size,this.size,[10]),this.ctx.fill()},t.prototype._assignValue=function(t){this.ctx.font="bold ".concat(this.config.board.fontSize,"px ").concat(this.config.board.font),this.ctx.textAlign="center",this.ctx.fillStyle="white",this.ctx.fillText(t,this.size/2,this.config.canvas.headerHeight+this.config.canvas.contentHeight/2+.33*this.config.board.fontSize)},t.prototype.alert=function(t){this.color="rgba(0,0,0, .55)",this.draw(),this._assignValue(t)},t}(),S=function(){function t(t){var o=t.ctx,i=t.config,e=t.position,n=t.title;this.ctx=o,this.color=i.button.color,this.position=e,this.config=i,this.fontSize=i.score.fontSize,this.fontColor=i.score.fontColor,this.font=i.score.font,this.x=this.position[0],this.y=this.position[1],this.width=i.button.width,this.height=i.button.height,this.title=n}return t.prototype._assignValue=function(){this.ctx.font="bold ".concat(this.fontSize,"px ").concat(this.font),this.ctx.textAlign="center",this.ctx.fillStyle=this.fontColor,this.ctx.fillText(this.title.toString(),this.x+this.width/2,this.y+this.height/2+this.fontSize/2.5)},t.prototype.draw=function(){this.ctx.fillStyle=this.color,this.ctx.beginPath(),this.ctx.roundRect(this.x,this.y,this.width,this.height,[10]),this.ctx.fill(),this._assignValue()},t.prototype.clickButton=function(t,o){var i=this.x+this.width,e=this.y+this.height;return i>t&&this.x<t&&e>o&&this.y<o},t}(),w=function(){function t(t){var o=t.ctx,i=t.size,e=t.coordinates,n=t.config;this.ctx=o,this.size=i,this.config=n,this.color="rgba(238, 228, 218, 0.35)",this.coordinates=e,this.x=this.config.board.map[this.coordinates[0]][this.coordinates[1]].x,this.y=this.config.board.map[this.coordinates[0]][this.coordinates[1]].y}return t.prototype.draw=function(){this.ctx.fillStyle=this.color,this.ctx.beginPath(),this.ctx.roundRect(this.x,this.y,this.size,this.size,[2]),this.ctx.fill()},t}(),z=function(){function t(t){var o=t.ctx,i=t.config,e=t.position,n=t.value,a=t.title;this.ctx=o,this.color=i.score.color,this.position=e,this.font=i.score.font,this.fontSize=i.score.fontSize,this.fontColor=i.score.fontColor,this.x=this.position[0],this.y=this.position[1],this.width=i.score.width,this.height=i.score.height,this.value=n,this.title=a}return t.prototype._assignValue=function(){this.ctx.font="bold ".concat(this.fontSize,"px ").concat(this.font),this.ctx.textAlign="center",this.ctx.fillStyle=this.fontColor,this.ctx.fillText(this.value.toString(),this.x+this.width/2,this.y+this.fontSize+6+this.height/2+this.fontSize/2.5),this.ctx.fillStyle=this.color,this.ctx.font="bold ".concat(.75*this.fontSize,"px ").concat(this.font),this.ctx.fillText(this.title.toString(),this.x+this.width/2,this.y+this.fontSize)},t.prototype.draw=function(){this.ctx.fillStyle=this.color,this.ctx.beginPath(),this.ctx.roundRect(this.x,this.y+this.fontSize+6,this.width,this.height,[10]),this.ctx.fill(),this._assignValue()},t}(),C=function(){var t=function(o,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])},t(o,i)};return function(o,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function e(){this.constructor=o}t(o,i),o.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}}(),E=function(t){function o(o){var i=o.ctx,e=o.coordinates,n=o.value,a=o.config,r=t.call(this,{ctx:i,size:a.cell.size,config:a,coordinates:e})||this;return r.config=a,r.value=n,r.strokeColor=a.board.strokeColor,r.ctx=i,r.size=a.cell.size,r.font=a.board.font,r.fontSize=a.board.fontSize,r.fontColor=a.board.fontColor,r.coordinates=e,r.x=r.config.board.map[r.coordinates[1]][r.coordinates[0]].x,r.y=r.config.board.map[r.coordinates[1]][r.coordinates[0]].y,r}return C(o,t),o.prototype._assignColor=function(){for(var t=Object.entries(u),o=0;o<t.length;)+t[o][0]===this.value&&(this.color=t[o][1]),this.value<8?this.fontColor="#776e65":this.fontColor="#f9f6f2",o++},o.prototype._assignValue=function(){this.ctx.font="bold ".concat(this.fontSize,"px ").concat(this.font),this.ctx.textAlign="center",this.ctx.fillStyle=this.fontColor,this.ctx.fillText(this.value.toString(),this.x+this.size/2,this.y+this.size/2+this.fontSize/2.5)},o.prototype.draw=function(){null!==this.value&&(this._assignColor(),this.ctx.fillStyle=this.color,this.ctx.beginPath(),this.ctx.roundRect(this.x,this.y,this.size,this.size,[2]),this.ctx.fill(),this._assignValue())},o}(w),O=document.querySelector("#canvas"),k=O.getContext("2d");O.width=e,O.height=n;var T=new m({canvas:O,ctx:k,config:f,engine:{tile:function(t){var o=t.ctx,i=t.coordinates,e=t.config,n=t.value;return new E({ctx:o,coordinates:i,value:n,config:e})},cell:function(t){var o=t.ctx,i=t.size,e=t.config,n=t.coordinates;return new w({ctx:o,size:i,config:e,coordinates:n})},board:function(t){var o=t.ctx,i=t.config;return new y({ctx:o,config:i})},score:function(t){var o=t.ctx,i=t.config,e=t.position,n=t.value,a=t.title;return new z({ctx:o,config:i,position:e,value:n,title:a})},button:function(t){var o=t.ctx,i=t.config,e=t.position,n=t.title;return new S({ctx:o,config:i,position:e,title:n})}}});T.start()})();